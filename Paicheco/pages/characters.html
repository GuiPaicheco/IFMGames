<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Escolha de Personagens — Ecos da Pedra Abissal</title>

  <style>
    /* ---------- Reset / base ---------- */
    :root{
      --accent-a:#00d4ff;
      --accent-b:#ff00ff;
      --bg:rgba(6,6,10,0.65);
      --panel-w:48%;
      --gap:18px;
      --card-radius:14px;
      --glass: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI; background:#05060a; color:#fff}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      background-image: url('../assets/images/MainBackGround.png');
      background-size:cover;
      background-position:center;
      -webkit-font-smoothing:antialiased;
    }

    /* ---------- Layout ---------- */
    .screen{
      width:100%;
      max-width:1200px;
      height:86vh;
      display:flex;
      flex-direction:column;
      gap:16px;
      position:relative;
      align-items:stretch;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .title{
      font-size:1.4rem;
      font-weight:700;
      letter-spacing:0.6px;
      text-shadow:0 2px 12px rgba(0,0,0,0.6);
    }
    .sub{
      color:#bfcbd6;
      font-size:0.9rem;
    }

    .middle{
      display:flex;
      gap:var(--gap);
      flex:1;
      align-items:stretch;
    }

    .panel{
      width:var(--panel-w);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--card-radius);
      border:1px solid rgba(255,255,255,0.06);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      backdrop-filter: blur(6px) saturate(1.05);
      position:relative;
      overflow:hidden;
    }

    /* label top */
    .player-label{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:4px;
    }
    .player-label h2{margin:0;font-size:1rem}
    .player-label .status{font-size:0.85rem;color:#cbd7df}

    /* central area: avatar + controls */
    .avatar-wrap{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .avatar-frame{
      width:220px;
      height:260px;
      border-radius:12px;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.35));
      border:1px solid rgba(255,255,255,0.04);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .avatar-bg{
      position:absolute; inset:0; background-size:cover; background-position:center; filter:contrast(1.05) saturate(0.9);
      opacity:0.9;
    }
    .avatar-img{
      width:60%;
      height:60%;
      object-fit:contain;
      z-index:2;
      filter:drop-shadow(0 6px 18px rgba(0,0,0,0.6));
    }
    .avatar-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      min-width:90px;
    }
    .arrow-btn{
      width:44px;height:44px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      display:flex;align-items:center;justify-content:center; cursor:pointer;
      transition:transform .14s, box-shadow .14s;
    }
    .arrow-btn:active{transform:translateY(2px) scale(.98)}
    .char-name{font-weight:700;margin-bottom:6px;text-align:center}

    /* selection lines for weapon & item */
    .selectors{
      display:flex;
      gap:10px;
      margin-top:6px;
    }
    .select-card{
      flex:1;
      background:var(--glass);
      border-radius:10px;
      padding:8px;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      border:1px solid rgba(255,255,255,0.03);
    }
    .select-card .sel-title{font-size:0.85rem;color:#cfefff}
    .sel-row{display:flex;gap:8px;align-items:center}
    .small-ico{width:36px;height:36px;object-fit:contain;border-radius:6px;background:rgba(0,0,0,0.25);padding:4px}

    /* info box */
    .info-box{
      margin-top:8px;
      background: rgba(0,0,0,0.45);
      border-radius:10px;
      padding:12px;
      flex:1;
      overflow:auto;
      font-size:0.95rem;
      line-height:1.35;
      border:1px solid rgba(255,255,255,0.03);
    }
    .info-rows{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    .info-pill{
      background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-weight:600;font-size:0.85rem;
      border:1px solid rgba(255,255,255,0.02)
    }

    /* confirm button */
    .confirm-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:8px}
    .confirm-btn{
      padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;
      background:linear-gradient(135deg,var(--accent-a),var(--accent-b));
      box-shadow:0 6px 18px rgba(0,0,0,0.45);
      transition:transform .12s,opacity .12s;
    }
    .confirm-btn:disabled{opacity:0.45;cursor:not-allowed; transform:none}

    /* center action area */
    .center-actions{
      width:4%;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:8px;
    }
    .start-btn{
      padding:12px 18px;border-radius:12px;border:none;cursor:pointer;font-weight:800;
      background:linear-gradient(135deg,#10b981,#047857);
      color:#fff;box-shadow:0 8px 28px rgba(4,120,87,0.2)
    }
    .hint{font-size:0.9rem;color:#a9cfe2;text-align:center;margin-top:6px}

    /* responsive */
    @media (max-width:980px){
      .middle{flex-direction:column}
      .panel{width:100%}
      .center-actions{width:100%;order:3}
    }
  </style>
</head>
<body>
  <div class="screen">
    <div class="topbar">
      <div>
        <div class="title">Escolha de Personagens</div>
        <div class="sub">Selecione o personagem, avatar, arma inicial e item. Ambos não podem escolher o mesmo personagem.</div>
      </div>
      <div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="sub">Hover e cliques tocam efeitos</div>
        </div>
      </div>
    </div>

    <div class="middle">
      <!-- Player 1 -->
      <div class="panel" id="panel1">
        <div class="player-label">
          <h2>Jogador 1</h2>
          <div class="status" id="status1">Escolha um personagem</div>
        </div>

        <div class="char-name" id="charName1"></div>

        <div class="avatar-wrap">
          <div style="flex:1">
            <div class="avatar-frame" id="avatarFrame1">
              <div class="avatar-bg" id="avatarBg1"></div>
              <img id="avatarImg1" class="avatar-img" src="" alt="avatar1">
            </div>
          </div>

          <div class="avatar-controls">
            <div class="arrow-btn" id="avatarPrev1" title="Avatar anterior">◀</div>
            <div class="arrow-btn" id="charPrev1" title="Personagem anterior">⟲</div>
            <div class="arrow-btn" id="charNext1" title="Próximo personagem">⟳</div>
            <div class="arrow-btn" id="avatarNext1" title="Próximo avatar">▶</div>
          </div>
        </div>

        <div class="selectors">
          <div class="select-card">
            <div class="sel-title">Arma Inicial</div>
            <div class="sel-row">
              <div class="arrow-btn" id="weaponPrev1">◀</div>
              <img id="weaponImg1" class="small-ico" src="" alt="weapon1">
              <div style="flex:1;text-align:left" id="weaponName1"></div>
              <div class="arrow-btn" id="weaponNext1">▶</div>
            </div>
          </div>

          <div class="select-card">
            <div class="sel-title">Item Inicial</div>
            <div class="sel-row">
              <div class="arrow-btn" id="itemPrev1">◀</div>
              <img id="itemImg1" class="small-ico" src="" alt="item1">
              <div style="flex:1;text-align:left" id="itemName1"></div>
              <div class="arrow-btn" id="itemNext1">▶</div>
            </div>
          </div>
        </div>

        <div class="info-box" id="info1">
          <!-- preenchido via JS -->
        </div>

        <div class="confirm-row">
          <div style="font-size:0.85rem;color:#c7eaf7">Quando ambos confirmarem, pressione "Iniciar Jogo".</div>
          <button class="confirm-btn" id="confirm1">Confirmar</button>
        </div>
      </div>

      <!-- center -->
      <div class="center-actions">
        <div style="writing-mode:vertical-rl; transform:rotate(180deg); font-weight:700; color:#bfeeff">VS</div>
        <button class="start-btn" id="startGame" disabled>Iniciar Jogo</button>
        <div class="hint">Se não escolherem, jogo aleatório</div>
      </div>

      <!-- Player 2 -->
      <div class="panel" id="panel2">
        <div class="player-label">
          <h2>Jogador 2</h2>
          <div class="status" id="status2">Escolha um personagem</div>
        </div>

        <div class="char-name" id="charName2"></div>

        <div class="avatar-wrap">
          <div style="flex:1">
            <div class="avatar-frame" id="avatarFrame2">
              <div class="avatar-bg" id="avatarBg2"></div>
              <img id="avatarImg2" class="avatar-img" src="" alt="avatar2">
            </div>
          </div>

          <div class="avatar-controls">
            <div class="arrow-btn" id="avatarPrev2" title="Avatar anterior">◀</div>
            <div class="arrow-btn" id="charPrev2" title="Personagem anterior">⟲</div>
            <div class="arrow-btn" id="charNext2" title="Próximo personagem">⟳</div>
            <div class="arrow-btn" id="avatarNext2" title="Próximo avatar">▶</div>
          </div>
        </div>

        <div class="selectors">
          <div class="select-card">
            <div class="sel-title">Arma Inicial</div>
            <div class="sel-row">
              <div class="arrow-btn" id="weaponPrev2">◀</div>
              <img id="weaponImg2" class="small-ico" src="" alt="weapon2">
              <div style="flex:1;text-align:left" id="weaponName2"></div>
              <div class="arrow-btn" id="weaponNext2">▶</div>
            </div>
          </div>

          <div class="select-card">
            <div class="sel-title">Item Inicial</div>
            <div class="sel-row">
              <div class="arrow-btn" id="itemPrev2">◀</div>
              <img id="itemImg2" class="small-ico" src="" alt="item2">
              <div style="flex:1;text-align:left" id="itemName2"></div>
              <div class="arrow-btn" id="itemNext2">▶</div>
            </div>
          </div>
        </div>

        <div class="info-box" id="info2"></div>

        <div class="confirm-row">
          <div style="font-size:0.85rem;color:#c7eaf7">Jogador não pode escolher personagem já confirmado pelo outro.</div>
          <button class="confirm-btn" id="confirm2">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ---------- SONS ---------- -->
  <audio id="ButtonHoverSound" src="assets/sounds/ButtonHoverSound.mp3" preload="auto"></audio>
  <audio id="ActionButtonSound" src="assets/sounds/ActionButtonSound.mp3" preload="auto"></audio>
  <audio id="ConfigButtonSound" src="assets/sounds/ConfigButtonSound.mp3" preload="auto"></audio>

  <script>
    /***** Dados dos personagens (fonte única) *****/
    const CHARACTERS = [
      {
        key: "Paicheco",
        name: "Paicheco Guilherme",
        classe: "Mago Nórdico",
        hp: 200,
        special: "Onipotência",
        avatars: ["Paicheco1.png","Paicheco2.png","Paicheco3.png"],
        weapons: [
          { name:"Cajado Arcano", icon:"cajado_arcano.png", desc:"Um cajado repleto de runas geladas."},
          { name:"Livro dos Deuses", icon:"livro_deuses.png", desc:"Volume antigo que sussurra decretos."},
          { name:"Varinha Divina", icon:"varinha_divina.png", desc:"Pequena varinha com energia pura."}
        ],
        history: "Paicheco Guilherme veio dos confins dos fiordes, estudou as artes arcanas e caminhou entre deuses. Sua busca é descobrir por que seu mundo perdeu as estrelas.",
      },
      {
        key: "Heringe",
        name: "Heringe Arthur",
        classe: "Samurai Algoz",
        hp: 250,
        special: "Cortes Atômicos",
        avatars: ["Heringe1.png","Heringe2.png","Heringe3.png"],
        weapons: [
          { name:"Katana Sanguinária", icon:"katana_sanguinaria.png", desc:"A lâmina bebe as bênçãos da batalha."},
          { name:"Wado Ichimonji", icon:"wado_ichimonji.png", desc:"Famosa espada honrada por ancestrais."},
          { name:"Espada Molecular", icon:"espada_molecular.png", desc:"Corta a própria realidade em fractais."}
        ],
        history: "Arthur é um jovem de 18 anos, abençoado por deuses. Nascido para enfrentar um mal que atravessa múltiplos universos, carrega honra e destino em sua lâmina.",
      },
      {
        key: "Laplace",
        name: "Pierre Laplace",
        classe: "Demônio do Amanhã",
        hp: 100,
        special: "Previsão Sanguinária",
        avatars: ["Laplace1.png","Laplace2.png","Laplace3.png"],
        weapons: [
          { name:"Punhos Deterministas", icon:"punhos_deterministas.png", desc:"Golpes que alteram probabilidades."},
          { name:"Colapsador", icon:"colapsador.png", desc:"Uma arma que força realidades a se dobrarem."}
        ],
        history: "Inspirado no matemático Laplace, Pierre manipula probabilidades e vê o amanhã como equações. Sua obsessão por destino fez dele um demônio do tempo.",
      },
      {
        key: "Magno",
        name: "Magno Tesla",
        classe: "Preceptor Vetorizado",
        hp: 150,
        special: "Eletromagnetismo",
        avatars: ["Magno1.png","Magno2.png","Magno3.png"],
        weapons: [
          { name:"Bobina Reativa", icon:"bobina_reativa.png", desc:"Emite arcos elétricos concussivos."},
          { name:"Emissor UltraVioleta", icon:"emissor_uv.png", desc:"Projeta pulsos que desorientam inimigos."}
        ],
        history: "Magno Tesla é um inventor excêntrico, mestre em campos elétricos. Como Nikola, busca energias para elevar a humanidade — e além.",
      }
      /***** Adicionar Lucas e Esther *****/
    ];

    const ITEMS = [
      { key:"vida", name:"Poção de Vida", icon:"pocao_vida.png", short:"Recupera completamente a vida", desc:`"Parece calda de morango..."\nRECUPERA COMPLETAMENTE A VIDA\n(Reabastece 3 após gastar todas e andar 10 andares)`},
      { key:"invis", name:"Poção de Invisibilidade", icon:"pocao_invisivel.png", short:"Invisível por todo o andar", desc:`"Tem cheiro de impressão 3D, quem fez essa poção?"\nDEIXA O JOGADOR INVISÍVEL POR TODO O ANDAR\n(Ganha 1 a cada 8 andares)`},
      { key:"perg", name:"Pergaminho do Futuro", icon:"pergaminho_futuro.png", short:"Revela o andar", desc:`"E se..."\nPERMITE SABER TUDO NO ANDAR E O CAMINHO PARA O PRÓXIMO\n(Ganha 1 a cada 9 andares)`},
      { key:"cord", name:"Cordão Místico", icon:"cordao_mistico.png", short:"Possível aliado", desc:`"É bonito, será que alguém vai gostar também?"\nPERMITE TER UM ALIADO QUANDO ENCONTRADO\n(Mantém-se até o final)`},
    ];

    /* ---------- Helpers para obter elementos ---------- */
    function $(id){ return document.getElementById(id); }
    function q(sel){ return document.querySelector(sel); }

    /* ---------- Sons ---------- */
    const ButtonHoverSound = $('ButtonHoverSound');
    const ActionButtonSound = $('ActionButtonSound');
    const ConfigButtonSound = $('ConfigButtonSound');

    function playSound(audio){
      if(!audio) return;
      try{
        const clone = audio.cloneNode();
        clone.play().catch(()=>{});
      }catch(e){}
    }

    /* ---------- Estado local (p1/p2) ---------- */
    const state = {
      p1: {charIndex:0, avatarIndex:0, weaponIndex:0, itemIndex:0, confirmed:false},
      p2: {charIndex:1, avatarIndex:0, weaponIndex:0, itemIndex:0, confirmed:false}
    };

    /* ---------- Inicialização ---------- */
    function init(){
      // populate UI initial
      renderPanel(1);
      renderPanel(2);
      wireControls();
      updateStartButtonState();
      // play hover sound on hover for clickable elements
      document.querySelectorAll('.arrow-btn,.confirm-btn,.start-btn').forEach(el=>{
        el.addEventListener('mouseenter', ()=> playSound(ButtonHoverSound));
        el.addEventListener('click', ()=> playSound(ActionButtonSound));
      });
    }

    /* ---------- Render panel ---------- */
    function renderPanel(playerNum){
      const p = (playerNum===1) ? state.p1 : state.p2;
      const other = (playerNum===1) ? state.p2 : state.p1;
      const panelSuffix = playerNum===1 ? '1' : '2';
      const char = CHARACTERS[p.charIndex];

      // name & status
      $( 'charName'+panelSuffix ).innerText = char.name;
      $( 'status'+panelSuffix ).innerText = p.confirmed ? 'Confirmado ✅' : 'Escolhendo...';

      // avatar paths (assumes folder assets/characters/avatars)
      const avatarFile = char.avatars[p.avatarIndex];
      const avatarPath = `assets/characters/avatars/${avatarFile}`;
      $('avatarImg'+panelSuffix).src = avatarPath;

      // background (naming: BackGround{Key}{N}.png as you requested)
      const bgName = `BackGround${char.key}${p.avatarIndex+1}.png`;
      const bgPath = `assets/characters/backgrounds/${bgName}`;
      $('avatarBg'+panelSuffix).style.backgroundImage = `url('${bgPath}')`;

      // weapon
      const weapon = char.weapons[p.weaponIndex];
      const wIconPath = `assets/icons/weapons/${weapon.icon}`;
      $('weaponImg'+panelSuffix).src = wIconPath;
      $('weaponName'+panelSuffix).innerText = weapon.name;

      // item
      const item = ITEMS[p.itemIndex];
      $('itemImg'+panelSuffix).src = `assets/icons/itens/${item.icon}`;
      $('itemName'+panelSuffix).innerText = item.name;

      // info box: full info
      const infoEl = $('info'+panelSuffix);
      infoEl.innerHTML = `
        <div style="font-weight:800;font-size:1.05rem;margin-bottom:8px">${char.name} • ${char.classe}</div>
        <div class="info-rows">
          <div class="info-pill">HP: ${char.hp}</div>
          <div class="info-pill">Habilidade: ${char.special}</div>
          <div class="info-pill">Arma: ${weapon.name}</div>
          <div class="info-pill">Item: ${item.name}</div>
        </div>
        <div style="font-size:0.95rem;white-space:pre-wrap">${char.history}</div>
        <hr style="opacity:.06;margin:10px 0;border:none;height:1px;background:linear-gradient(90deg,transparent,#ffffff20,transparent)">
        <div style="font-weight:700;margin-bottom:6px">Descrição da Arma</div>
        <div style="margin-bottom:8px">${weapon.desc}</div>
        <div style="font-weight:700;margin-bottom:6px">Descrição do Item</div>
        <div style="white-space:pre-wrap">${item.desc}</div>
      `;

      // if other player confirmed this same character, disable confirm
      const otherCharKey = CHARACTERS[other.charIndex].key;
      const thisCharKey = char.key;
      const confirmBtn = $('confirm'+panelSuffix);
      if(other.confirmed && otherCharKey === thisCharKey){
        confirmBtn.disabled = true;
        confirmBtn.innerText = 'Indisponível (outro já escolheu)';
      } else {
        confirmBtn.disabled = p.confirmed ? true : false;
        confirmBtn.innerText = p.confirmed ? 'Confirmado' : 'Confirmar';
      }
    }

    /* ---------- Wire controls ---------- */
    function wireControls(){
      // character cycle (prev/next) for both players
      ['1','2'].forEach(suf=>{
        $('charPrev'+suf).addEventListener('click', ()=> {
          changeChar(parseInt(suf), -1);
        });
        $('charNext'+suf).addEventListener('click', ()=> {
          changeChar(parseInt(suf), +1);
        });
        // avatar
        $('avatarPrev'+suf).addEventListener('click', ()=> changeAvatar(parseInt(suf), -1));
        $('avatarNext'+suf).addEventListener('click', ()=> changeAvatar(parseInt(suf), +1));
        // weapon
        $('weaponPrev'+suf).addEventListener('click', ()=> changeWeapon(parseInt(suf), -1));
        $('weaponNext'+suf).addEventListener('click', ()=> changeWeapon(parseInt(suf), +1));
        // item
        $('itemPrev'+suf).addEventListener('click', ()=> changeItem(parseInt(suf), -1));
        $('itemNext'+suf).addEventListener('click', ()=> changeItem(parseInt(suf), +1));
        // confirm
        $('confirm'+suf).addEventListener('click', ()=> confirmChoice(parseInt(suf)));
      });

      // start game
      $('startGame').addEventListener('click', startGameFlow);

      // hover sound for arrows & interactive
      document.querySelectorAll('.arrow-btn,.confirm-btn,.start-btn').forEach(el=>{
        el.addEventListener('mouseenter', ()=> playSound(ButtonHoverSound));
      });
    }

    /* ---------- change functions ---------- */
    function clampIndex(i, len){
      if(i<0) return (len-1);
      if(i>=len) return 0;
      return i;
    }

    function changeChar(playerNum, delta){
      const p = playerNum===1 ? state.p1 : state.p2;
      if(p.confirmed) return; // can't change after confirmed
      p.charIndex = clampIndex(p.charIndex + delta, CHARACTERS.length);
      // reset avatar/weapon indexes to valid defaults
      p.avatarIndex = clampIndex(p.avatarIndex, CHARACTERS[p.charIndex].avatars.length);
      p.weaponIndex = clampIndex(p.weaponIndex, CHARACTERS[p.charIndex].weapons.length);
      // item stays same index but safe clamp
      p.itemIndex = clampIndex(p.itemIndex, ITEMS.length);
      renderPanel(playerNum);
      // ensure players are not picking the same char when other already confirmed
      enforceConflict();
      playSound(ActionButtonSound);
    }

    function changeAvatar(playerNum, delta){
      const p = playerNum===1 ? state.p1 : state.p2;
      if(p.confirmed) return;
      const avatars = CHARACTERS[p.charIndex].avatars;
      p.avatarIndex = clampIndex(p.avatarIndex + delta, avatars.length);
      renderPanel(playerNum);
      playSound(ActionButtonSound);
    }

    function changeWeapon(playerNum, delta){
      const p = playerNum===1 ? state.p1 : state.p2;
      if(p.confirmed) return;
      const weps = CHARACTERS[p.charIndex].weapons;
      p.weaponIndex = clampIndex(p.weaponIndex + delta, weps.length);
      renderPanel(playerNum);
      playSound(ActionButtonSound);
    }

    function changeItem(playerNum, delta){
      const p = playerNum===1 ? state.p1 : state.p2;
      if(p.confirmed) return;
      p.itemIndex = clampIndex(p.itemIndex + delta, ITEMS.length);
      renderPanel(playerNum);
      playSound(ActionButtonSound);
    }

    /* ---------- Conflict handling ---------- */
    function enforceConflict(){
      // if one confirmed a char, the other cannot confirm or choose that char
      // update both panels render
      renderPanel(1);
      renderPanel(2);
      updateStartButtonState();
    }

    /* ---------- Confirm ---------- */
    function confirmChoice(playerNum){
      const p = playerNum===1 ? state.p1 : state.p2;
      const other = playerNum===1 ? state.p2 : state.p1;

      // if other already confirmed same char, block
      if(other.confirmed && CHARACTERS[other.charIndex].key === CHARACTERS[p.charIndex].key){
        alert('Este personagem já foi confirmado pelo outro jogador. Escolha outro.');
        return;
      }

      p.confirmed = true;
      renderPanel(playerNum);
      playSound(ConfigButtonSound);
      updateStartButtonState();
    }

    function bothConfirmed(){
      return state.p1.confirmed && state.p2.confirmed;
    }

    /* ---------- Start game: save to localStorage and redirect ---------- */
    function startGameFlow(){
      // if not both confirmed, allow starting but will randomize missing
      // build data for p1 and p2 (if not confirmed, pick current selection)
      const buildSave = (pState) => {
        const char = CHARACTERS[pState.charIndex];
        return {
          personagem: char.name,
          key: char.key,
          classe: char.classe,
          hp: char.hp,
          especial: char.special,
          arma: char.weapons[pState.weaponIndex].name,
          armaIcon: char.weapons[pState.weaponIndex].icon,
          item: ITEMS[pState.itemIndex].name,
          itemKey: ITEMS[pState.itemIndex].key,
          avatar: char.avatars[pState.avatarIndex],
          background: `BackGround${char.key}${pState.avatarIndex+1}.png`
        };
      };

      const save1 = buildSave(state.p1);
      const save2 = buildSave(state.p2);

      localStorage.setItem('personagem1', JSON.stringify(save1));
      localStorage.setItem('personagem2', JSON.stringify(save2));

      // small feedback then redirect
      alert('Personagens salvos! Iniciando o jogo...');
      playSound(ActionButtonSound);
      // redirect to main.html
      window.location.href = 'main.html';
    }

    function updateStartButtonState(){
      $('startGame').disabled = !( state.p1.confirmed && state.p2.confirmed );
    }

    /* ---------- On load ---------- */
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

